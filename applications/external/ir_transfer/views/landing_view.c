#include "landing_view.h"
#include <gui/elements.h>
#include <ir_transfer_icons.h> // Assuming this is needed for icons
#include "../utils/draw_utils.h"

static void Landing_draw_callback(Canvas* canvas, void* model) {
    UNUSED(model);
    static const uint8_t image_IR_2_0_bits[] = {
        0x1c, 0xff, 0x01, 0xfc, 0x77, 0x1c, 0xe0, 0x7f, 0x1c, 0xff, 0x03, 0xfc, 0x77, 0x1c, 0xe0,
        0x3f, 0x1c, 0x83, 0x03, 0x0c, 0x70, 0x0c, 0x60, 0x00, 0x8c, 0x83, 0x03, 0x0e, 0x30, 0x0e,
        0x70, 0x00, 0x8c, 0x83, 0x03, 0x0e, 0x30, 0x0e, 0x70, 0x00, 0x8e, 0xc3, 0x01, 0xfe, 0x39,
        0x0e, 0xf0, 0x1f, 0x8e, 0xff, 0x00, 0xfe, 0x39, 0x0e, 0xf0, 0x1f, 0x8e, 0xff, 0x00, 0x07,
        0x38, 0x06, 0x30, 0x00, 0xc6, 0xc1, 0x01, 0x07, 0x18, 0x07, 0x38, 0x00, 0xc6, 0xc1, 0x01,
        0x07, 0x18, 0x07, 0x38, 0x00, 0xc7, 0xe1, 0x00, 0x07, 0x1c, 0x07, 0x38, 0x00, 0xc7, 0xe0,
        0x00, 0x03, 0x1c, 0xff, 0xf9, 0x1f, 0xc7, 0xe0, 0x81, 0x03, 0x1c, 0xff, 0xf8, 0x0f};
    static const uint8_t image_TR_1_0_bits[] = {
        0xff, 0xf3, 0x1f, 0xf0, 0xc0, 0xc1, 0xe1, 0x87, 0xff, 0xfc, 0xcf, 0x7f, 0xff, 0xf3, 0x3f,
        0xf0, 0xc0, 0xc1, 0xf8, 0x9f, 0xff, 0xfc, 0xc7, 0xff, 0x38, 0x30, 0x38, 0xf8, 0xe0, 0xc3,
        0x38, 0x9c, 0x01, 0x0c, 0xc0, 0xe0, 0x38, 0x38, 0x38, 0xf8, 0xe0, 0xe3, 0x1c, 0xdc, 0x01,
        0x0e, 0xe0, 0xe0, 0x38, 0x38, 0x38, 0xec, 0xe1, 0xe3, 0x1c, 0xc0, 0x01, 0x0e, 0xe0, 0xe0,
        0x38, 0x38, 0x1c, 0xcc, 0x61, 0x67, 0xfc, 0xc0, 0x3f, 0xfe, 0xe3, 0x70, 0x18, 0xf8, 0x0f,
        0xc6, 0x61, 0x66, 0xf8, 0xc7, 0x3f, 0xfe, 0xe3, 0x3f, 0x1c, 0xf8, 0x0f, 0xc7, 0x71, 0x6e,
        0xc0, 0xef, 0x00, 0x06, 0xe0, 0x3f, 0x1c, 0x1c, 0x1c, 0xff, 0x71, 0x7c, 0x00, 0xee, 0x00,
        0x07, 0x70, 0x70, 0x1c, 0x1c, 0x9c, 0xff, 0x71, 0x7c, 0x07, 0xee, 0x00, 0x07, 0x70, 0x70,
        0x0c, 0x1c, 0x8e, 0xc1, 0x33, 0x3c, 0x0f, 0xe7, 0x00, 0x07, 0x70, 0x38, 0x0c, 0x0c, 0xce,
        0x81, 0x33, 0x38, 0xfe, 0x67, 0x00, 0xff, 0x33, 0x38, 0x0e, 0x0c, 0xde, 0x80, 0x3b, 0x38,
        0xfc, 0x71, 0x00, 0xff, 0x31, 0x78};
    static const uint8_t image_folder_open_0_bits[] = {
        0x00, 0xc0, 0x02, 0x00, 0x20, 0x03, 0x00, 0x90, 0x03, 0x3e, 0x00, 0x00,
        0xc1, 0x3f, 0x00, 0x01, 0x40, 0x00, 0x01, 0x40, 0x00, 0x01, 0x40, 0x00,
        0xe1, 0xff, 0x03, 0x11, 0x00, 0x02, 0x11, 0x00, 0x02, 0x09, 0x00, 0x01,
        0x09, 0x00, 0x01, 0x05, 0x80, 0x00, 0x05, 0x80, 0x00, 0xfe, 0x7f, 0x00};
    canvas_set_bitmap_mode(canvas, true);
    canvas_draw_xbm(canvas, 20, 9, 63, 13, image_IR_2_0_bits);
    canvas_draw_xbm(canvas, 14, 29, 96, 13, image_TR_1_0_bits);
    canvas_draw_xbm(canvas, 89, 6, 18, 16, image_folder_open_0_bits);
    canvas_set_font(canvas, FontPrimary);
    elements_button_left(canvas, "send");
    elements_button_right(canvas, "receive");
}

static bool Landing_input_callback(InputEvent* event, void* context) {
    App* app = (App*)context;

    if(event->type == InputTypeShort) {
        if(event->key == InputKeyLeft) {
            FURI_LOG_I("Send", "Switching to SendView");
            view_dispatcher_switch_to_view(app->view_dispatcher, SendView);
            return true;

        } else if(event->key == InputKeyRight) {
            FURI_LOG_I("Rec", "Switching to RecView");
            view_dispatcher_switch_to_view(app->view_dispatcher, RecView);

            return true;
        }
    }
    return false;
}

static uint32_t landing_exit_callback(void* _context) {
    UNUSED(_context);
    return VIEW_NONE;
}

View* landing_view_alloc(App* app) {
    View* landing_view = view_alloc();
    view_set_draw_callback(landing_view, Landing_draw_callback);
    view_set_input_callback(landing_view, Landing_input_callback);
    view_set_previous_callback(landing_view, landing_exit_callback);
    view_set_context(landing_view, app);
    view_allocate_model(landing_view, ViewModelTypeLockFree, sizeof(LandingModel));
    LandingModel* landing_model = view_get_model(landing_view);
    UNUSED(landing_model);
    return landing_view;
}

void landing_view_free(View* landing_view) {
    furi_assert(landing_view);
    view_free(landing_view);
}
