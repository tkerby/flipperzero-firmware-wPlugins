# APDU Response Decoder

APDU Response Decoder is a tool for parsing and displaying .apdures files generated by the Flipper Zero NFC APDU Runner application.

## Features

- Load .apdures files from local files or directly from a Flipper Zero device
- Parse and display APDU response data using custom templates
- Support for decoding and formatting hexadecimal data

## Installation

### Building from Source

1. Ensure you have Go 1.20 or higher installed
2. Clone the repository
3. Navigate to the `tools/ResponseDecoder` directory
4. Run `go build -o response_decoder`

## Usage

### Loading from a File

```bash
./response_decoder -f /path/to/file.apdures
```

### Loading from a Flipper Zero Device

```bash
./response_decoder -d
```

### Using a Custom Decoding Format

```bash
./response_decoder -f /path/to/file.apdures --decode-format /path/to/format.apdufmt
```

If no decoding format is specified, the program will list all .apdufmt files in the `format` directory and prompt the user to select one.

## Format Templates

Format template files (.apdufmt) define how to parse and display APDU response data. The format is as follows:

```
PBOC
Card Number: {hex(O[1][10:18])}
Name: {hex(O[2][10:20], "utf-8")}
Balance: {hex(O[3][10:18])} Yuan
Valid Until: 20{O[4][10:12]}-{O[4][12:14]}
Transaction Records: {hex(O[5][10:30])}
```

- The first line is the title, which will be centered in the display
- Starting from the second line is the display content, where `{}` contains placeholders to be converted, and the rest is displayed directly
- Placeholder format:
  - `O[index]` refers to the index-th output data
  - `I[index]` refers to the index-th input data
  - `[start:end]` represents a string slice, similar to Python's slice syntax
  - `hex(data)` function converts a hexadecimal string to readable text
  - `hex(data, "encoding")` function specifies the encoding, default is "gbk"

## Example

Given the following .apdures file:

```
Filetype: APDU Script Response
Response:
In: 00A4040007A0000002471001
Out: 9000
In: 00B0000000
Out: 6230303030313233343536373839303030309000
In: 00B0000100
Out: E5BCA0E4B889E69D8FE58D8E000000009000
In: 00B0000200
Out: 3130302E35309000
In: 00B0000300
Out: 2403319000
In: 00B0000400
Out: E69C80E8BF91E4BAA4E69893E8AEB0E5BD95E5A682E4B88B9000
```

Using the PBOC format template above, the output would look like:

```
==================================================
                      PBOC                      
==================================================
Card Number: 6000012345678900
Name: Zhang San Xing Hua
Balance: 100.50 Yuan
Valid Until: 2024-03
Transaction Records: Recent transaction records as follows
```

## License

This project is licensed under the GNU General Public License v3.0 - see the LICENSE file for details. 